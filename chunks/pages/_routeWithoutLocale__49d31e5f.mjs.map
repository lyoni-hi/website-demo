{"version":3,"file":"_routeWithoutLocale__49d31e5f.mjs","sources":["../../../src/locales/index.ts","../../../src/scripts-ssr/utils.ts","../../../src/pages/[routeWithoutLocale].astro"],"sourcesContent":["export type TransStrings = typeof import(\"./en\").default;\nexport type TransKey = ObjectToDotProp<TransStrings>;\n\ntype Unstricten<T> = {\n    [K in keyof T]: T[K] extends Record<string, unknown>\n        ? Unstricten<T[K]>\n        : T[K] extends string\n        ? string\n        : T[K];\n};\n\ntype ResolvePropDeep<T, P> = P extends \"\"\n    ? T\n    : P extends `${infer Pre}.${infer Suf}`\n    ? Pre extends keyof T\n        ? ResolvePropDeep<T[Pre], Suf>\n        : never\n    : P extends keyof T\n    ? T[P]\n    : never;\n\ntype ObjectToDotProp<T extends object> = ObjectToDotPropInternal<T>[keyof T];\n\ntype ObjectToDotPropInternal<T extends object> = {\n    [Key in keyof T]: Key extends string\n        ? T[Key] extends Record<string, unknown>\n            ? ObjectToDotProp<T[Key]> extends string\n                ? // @ts-ignore \"Type instantiation is excessively deep and possibly infinite\"\n                  `${Key}.${ObjectToDotProp<T[Key]>}`\n                : never\n            : Key\n        : never;\n};\n\nexport function defineLocale(strings: Unstricten<TransStrings>) {\n    return strings;\n}\n\nconst LocaleStrings = {\n    // de: () => import(\"./de\"),\n    en: () => import(\"./en\"),\n};\n\nexport const Locales = Object.keys(LocaleStrings);\n\nexport const getStaticPaths = () =>\n    Object.keys(LocaleStrings).map(lang => ({ params: { lang } }));\n\ntype t = <Trans extends TransKey>(\n    trans: Trans,\n    params?: Record<string, string>\n) => ResolvePropDeep<TransStrings, Trans>;\n\nexport async function loadStrings(\n    locale: string | undefined\n): Promise<t | null>;\nexport async function loadStrings(\n    locale: string | undefined,\n    throwIfMissing: true\n): Promise<t>;\nexport async function loadStrings(\n    locale: string | undefined,\n    throwIfMissing = false\n): Promise<t | null> {\n    if (!locale || !LocaleStrings[locale]) {\n        if (throwIfMissing) throw new Error(\"Invalid locale \" + locale);\n        return null;\n    }\n\n    const { default: strings } = await LocaleStrings[locale]();\n\n    return function <Trans extends TransKey>(\n        trans: Trans,\n        params?: Record<string, string>\n    ): ResolvePropDeep<TransStrings, Trans> {\n        let v: any = strings;\n        for (const path of trans.split(\".\")) {\n            v = v[path];\n            if (!v) throw new Error(\"Missing translation \" + trans);\n        }\n\n        if (typeof v !== \"string\")\n            throw new Error(\"Missing translation \" + trans);\n\n        if (params)\n            for (const [key, value] of Object.entries(params)) {\n                v = v.replaceAll(`{{${key}}}`, value);\n            }\n\n        return v;\n    };\n}\n","export async function redirectTo404(url: URL, headers: Headers) {\n    const res = await fetch(new URL(\"/404\", url), {\n        headers,\n    });\n\n    return new Response(res.body, {\n        status: 404,\n        statusText: \"Not Found\",\n        headers: {\n            ...res.headers,\n            \"Content-Type\": \"text/html\",\n        },\n    });\n}\n","---\nimport { redirectTo404 } from \"scripts-ssr/utils\";\nimport parser from \"accept-language-parser\";\nimport { Locales } from \"../locales\";\n\nconst routes = [\"about\", \"contact\", \"blog\"];\nconst route = Astro.params.routeWithoutLocale;\nif (!routes.includes(route!))\n    return redirectTo404(Astro.url, Astro.request.headers);\n\nconst acceptLanguages = Astro.request.headers.get(\"Accept-Language\");\nif (!acceptLanguages) return Astro.redirect(`/en/${route}`, 302);\n\nconst lang = parser.pick(Locales, acceptLanguages) || \"en\";\n\nreturn Astro.redirect(`/${lang}/${route}`, 302);\n---\n"],"names":["$$createAstro","$$createComponent","Astro"],"mappings":";;;;AAsCA,MAAM,aAAgB,GAAA;AAAA;AAAA,EAElB,EAAA,EAAI,MAAM,OAAO,oBAAM,CAAA;AAC3B,CAAA,CAAA;AAEa,MAAA,OAAA,GAAU,MAAO,CAAA,IAAA,CAAK,aAAa,EAAA;AAEzC,MAAM,cAAiB,GAAA,MAC1B,MAAO,CAAA,IAAA,CAAK,aAAa,CAAA,CAAE,GAAI,CAAA,CAAA,IAAA,MAAS,EAAE,MAAA,EAAQ,EAAE,IAAA,IAAS,CAAA,EAAA;AAc3C,eAAA,WAAA,CAClB,MACA,EAAA,cAAA,GAAiB,KACA,EAAA;AACjB,EAAA,IAAI,CAAC,MAAA,IAAU,CAAC,aAAA,CAAc,MAAM,CAAG,EAAA;AACnC,IAAI,IAAA,cAAA;AAAgB,MAAM,MAAA,IAAI,KAAM,CAAA,iBAAA,GAAoB,MAAM,CAAA,CAAA;AAC9D,IAAO,OAAA,IAAA,CAAA;AAAA,GACX;AAEA,EAAA,MAAM,EAAE,OAAS,EAAA,OAAA,KAAY,MAAM,aAAA,CAAc,MAAM,CAAE,EAAA,CAAA;AAEzD,EAAO,OAAA,SACH,OACA,MACoC,EAAA;AACpC,IAAA,IAAI,CAAS,GAAA,OAAA,CAAA;AACb,IAAA,KAAA,MAAW,IAAQ,IAAA,KAAA,CAAM,KAAM,CAAA,GAAG,CAAG,EAAA;AACjC,MAAA,CAAA,GAAI,EAAE,IAAI,CAAA,CAAA;AACV,MAAA,IAAI,CAAC,CAAA;AAAG,QAAM,MAAA,IAAI,KAAM,CAAA,sBAAA,GAAyB,KAAK,CAAA,CAAA;AAAA,KAC1D;AAEA,IAAA,IAAI,OAAO,CAAM,KAAA,QAAA;AACb,MAAM,MAAA,IAAI,KAAM,CAAA,sBAAA,GAAyB,KAAK,CAAA,CAAA;AAElD,IAAI,IAAA,MAAA;AACA,MAAA,KAAA,MAAW,CAAC,GAAK,EAAA,KAAK,KAAK,MAAO,CAAA,OAAA,CAAQ,MAAM,CAAG,EAAA;AAC/C,QAAA,CAAA,GAAI,CAAE,CAAA,UAAA,CAAW,CAAK,EAAA,EAAA,GAAG,MAAM,KAAK,CAAA,CAAA;AAAA,OACxC;AAEJ,IAAO,OAAA,CAAA,CAAA;AAAA,GACX,CAAA;AACJ;;AC3FsB,eAAA,aAAA,CAAc,KAAU,OAAkB,EAAA;AAC5D,EAAA,MAAM,MAAM,MAAM,KAAA,CAAM,IAAI,GAAI,CAAA,MAAA,EAAQ,GAAG,CAAG,EAAA;AAAA,IAC1C,OAAA;AAAA,GACH,CAAA,CAAA;AAED,EAAO,OAAA,IAAI,QAAS,CAAA,GAAA,CAAI,IAAM,EAAA;AAAA,IAC1B,MAAQ,EAAA,GAAA;AAAA,IACR,UAAY,EAAA,WAAA;AAAA,IACZ,OAAS,EAAA;AAAA,MACL,GAAG,GAAI,CAAA,OAAA;AAAA,MACP,cAAgB,EAAA,WAAA;AAAA,KACpB;AAAA,GACH,CAAA,CAAA;AACL;;ACbA,MAAA,OAAA,GAAAA,YAAA,0CAAA,CAAA,CAAA;AAAA,MAAA,oBAAA,GAAAC,eAAA,CAAA,CAAA,QAAA,EAAA,SAAA,OAAA,KAAA;AAAA,EAAA,MAAAC,MAAA,GAAA,QAAA,CAAA,WAAA,CAAA,OAAA,EAAA,SAAA,OAAA,CAAA,CAAA;AAAA,EAAAA,OAAA,IAAA,GAAA,oBAAA,CAAA;AAKA,EAAA,MAAM,MAAS,GAAA,CAAC,OAAS,EAAA,SAAA,EAAW,MAAM,CAAA,CAAA;AAC1C,EAAM,MAAA,KAAA,GAAQA,OAAM,MAAO,CAAA,kBAAA,CAAA;AAC3B,EAAI,IAAA,CAAC,MAAO,CAAA,QAAA,CAAS,KAAM,CAAA;AACvB,IAAA,OAAO,aAAcA,CAAAA,MAAAA,CAAM,GAAKA,EAAAA,MAAAA,CAAM,QAAQ,OAAO,CAAA,CAAA;AAEzD,EAAA,MAAM,eAAkBA,GAAAA,MAAAA,CAAM,OAAQ,CAAA,OAAA,CAAQ,IAAI,iBAAiB,CAAA,CAAA;AACnE,EAAA,IAAI,CAAC,eAAA;AAAiB,IAAA,OAAOA,MAAM,CAAA,QAAA,CAAS,CAAO,IAAA,EAAA,KAAK,IAAI,GAAG,CAAA,CAAA;AAE/D,EAAA,MAAM,IAAO,GAAA,MAAA,CAAO,IAAK,CAAA,OAAA,EAAS,eAAe,CAAK,IAAA,IAAA,CAAA;AAEtD,EAAA,OAAOA,OAAM,QAAS,CAAA,CAAA,CAAA,EAAI,IAAI,CAAI,CAAA,EAAA,KAAK,IAAI,GAAG,CAAA,CAAA;AAf9C,CAAA,EAAA,oEAAA,KAAA,CAAA,CAAA,CAAA;;;;;;;;;;;;;;"}